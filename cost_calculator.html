<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM API Call Cost Calculator</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            line-height: 1.6;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        input[type="number"] {
            width: 150px;
            padding: 8px;
            margin-top: 5px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
        }
        button:hover {
            background-color: #0056b3;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #eee;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        #result p {
            margin: 5px 0;
        }
        .cost-input {
             display: inline-block;
             margin-left: 5px;
        }
        .cost-label {
            display: inline-block;
        }
    </style>
</head>
<body>

    <h1>LLM API Call Cost Calculator</h1>

    <div>
        <label for="logFile">Select usage.log File:</label>
        <input type="file" id="logFile" accept=".log" style="margin-top: 5px;">
        <span id="fileName" style="margin-left: 10px; font-style: italic;">No file selected</span>
    </div>

    <div style="margin-top: 15px;">
        <p style="margin-bottom: 5px;"><strong>Parsed Tokens (from last valid log line):</strong></p>
        <div style="padding: 10px; background-color: #f0f0f0; border-radius: 4px;">
            <span>Prompt: </span><strong id="parsedPromptTokens">N/A</strong> | 
            <span>Completion: </span><strong id="parsedCompletionTokens">N/A</strong>
        </div>
    </div>

    <hr style="margin-top: 20px; margin-bottom: 20px;">

    <p>Enter cost per <strong>1,000</strong> tokens:</p>
    <div>
        <label for="promptCost" class="cost-label">Prompt Cost ($):</label>
        <input type="number" id="promptCost" name="promptCost" value="0.000165" step="0.000001" min="0" class="cost-input"> 
        <span> / 1k tokens</span>
    </div>

     <div>
        <label for="completionCost" class="cost-label">Completion Cost ($):</label>
        <input type="number" id="completionCost" name="completionCost" value="0.00066" step="0.00001" min="0" class="cost-input">
         <span> / 1k tokens</span>
    </div>

    <button id="calculateBtn">Calculate Cost</button>

    <div id="result" style="display: none;">
        <h2>Results</h2>
        <p><strong>Based on Parsed Tokens:</strong></p>
        <p> - Prompt Tokens: <span id="resultPromptTokens"></span></p>
        <p> - Completion Tokens: <span id="resultCompletionTokens"></span></p>
        <p><strong>Total Tokens:</strong> <span id="totalTokens"></span></p>
        <p><strong>Estimated Cost:</strong> $<span id="totalCost"></span></p>
    </div>

    <script>
        const calculateBtn = document.getElementById('calculateBtn');
        const resultDiv = document.getElementById('result');
        const logFileInput = document.getElementById('logFile');
        const fileNameSpan = document.getElementById('fileName');
        const parsedPromptTokensSpan = document.getElementById('parsedPromptTokens');
        const parsedCompletionTokensSpan = document.getElementById('parsedCompletionTokens');
        const promptCostInput = document.getElementById('promptCost');
        const completionCostInput = document.getElementById('completionCost');
        const resultPromptTokensSpan = document.getElementById('resultPromptTokens');
        const resultCompletionTokensSpan = document.getElementById('resultCompletionTokens');
        const totalTokensSpan = document.getElementById('totalTokens');
        const totalCostSpan = document.getElementById('totalCost');

        let currentPromptTokens = 0;
        let currentCompletionTokens = 0;

        logFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) {
                fileNameSpan.textContent = 'No file selected';
                parsedPromptTokensSpan.textContent = 'N/A';
                parsedCompletionTokensSpan.textContent = 'N/A';
                currentPromptTokens = 0;
                currentCompletionTokens = 0;
                resultDiv.style.display = 'none'; // Hide result if file removed
                return;
            }

            fileNameSpan.textContent = file.name;
            parsedPromptTokensSpan.textContent = 'Parsing...';
            parsedCompletionTokensSpan.textContent = 'Parsing...';
            resultDiv.style.display = 'none'; // Hide old result

            const reader = new FileReader();

            reader.onload = (e) => {
                const content = e.target.result;
                const lines = content.split(/\r\n|\n/); // Split by lines
                let found = false;

                // Regex to find PROMPT_TOKENS=number and COMPLETION_TOKENS=number
                const tokenRegex = /PROMPT_TOKENS=(\d+)\s+COMPLETION_TOKENS=(\d+)/;

                // Iterate backwards to find the last valid line
                for (let i = lines.length - 1; i >= 0; i--) {
                    const line = lines[i];
                    const match = line.match(tokenRegex);
                    if (match && match[1] && match[2]) {
                        currentPromptTokens = parseInt(match[1]) || 0;
                        currentCompletionTokens = parseInt(match[2]) || 0;
                        parsedPromptTokensSpan.textContent = currentPromptTokens.toLocaleString();
                        parsedCompletionTokensSpan.textContent = currentCompletionTokens.toLocaleString();
                        found = true;
                        console.log(`Parsed from line ${i + 1}: Prompt=${currentPromptTokens}, Completion=${currentCompletionTokens}`);
                        break; // Stop after finding the last valid line
                    }
                }

                if (!found) {
                    parsedPromptTokensSpan.textContent = 'Error';
                    parsedCompletionTokensSpan.textContent = 'Error';
                    currentPromptTokens = 0;
                    currentCompletionTokens = 0;
                    console.error('Could not find valid token line in log file.');
                    alert('Could not find a line with PROMPT_TOKENS and COMPLETION_TOKENS in the selected file.');
                }
            };

            reader.onerror = (e) => {
                console.error("File reading error:", e);
                fileNameSpan.textContent = 'Error reading file';
                parsedPromptTokensSpan.textContent = 'Error';
                parsedCompletionTokensSpan.textContent = 'Error';
                 currentPromptTokens = 0;
                 currentCompletionTokens = 0;
                 alert('Error reading the selected file.');
            };

            reader.readAsText(file); // Read the file as text
        });

        calculateBtn.addEventListener('click', () => {
            // Use the parsed values stored in variables
            const promptTokens = currentPromptTokens;
            const completionTokens = currentCompletionTokens;
            
            // Cost is per 1000 tokens
            const promptCostPer1k = parseFloat(promptCostInput.value) || 0;
            const completionCostPer1k = parseFloat(completionCostInput.value) || 0;

            if (promptTokens === 0 && completionTokens === 0) {
                alert("Please select a valid log file first, or ensure it contains token data.");
                return;
            }

            const totalTokens = promptTokens + completionTokens;

            const promptCost = (promptTokens / 1000) * promptCostPer1k;
            const completionCost = (completionTokens / 1000) * completionCostPer1k;
            const totalCost = promptCost + completionCost;

            // Update result display
            resultPromptTokensSpan.textContent = promptTokens.toLocaleString();
            resultCompletionTokensSpan.textContent = completionTokens.toLocaleString();
            totalTokensSpan.textContent = totalTokens.toLocaleString();
            totalCostSpan.textContent = totalCost.toFixed(6); 

            resultDiv.style.display = 'block';
        });
    </script>

</body>
</html> 